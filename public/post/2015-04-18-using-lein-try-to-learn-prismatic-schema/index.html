<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Using lein-try to learn Prismatic Schema - Rubygeek</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Using lein-try to learn Prismatic Schema" />
<meta property="og:description" content="When I first heard of lein-try on the Cognitect Podcast (and then again in the Clojure Cookbook I thought wow! How cool is that! I tried it with following the example in the readme clj-time to get familar with using it.
First add lein-try to your ~/.lein/profiles plugins vector, run lein deps to get it installed.
{:user {:plugins [lein-try &#34;0.4.3&#34;]}} I wanted to understand Prismatic’s Schema and wanted to try it." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://rubygeek.com/post/2015-04-18-using-lein-try-to-learn-prismatic-schema/" />
<meta property="article:published_time" content="2015-04-18T15:13:10+00:00" />
<meta property="article:modified_time" content="2015-04-18T15:13:10+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Using lein-try to learn Prismatic Schema"/>
<meta name="twitter:description" content="When I first heard of lein-try on the Cognitect Podcast (and then again in the Clojure Cookbook I thought wow! How cool is that! I tried it with following the example in the readme clj-time to get familar with using it.
First add lein-try to your ~/.lein/profiles plugins vector, run lein deps to get it installed.
{:user {:plugins [lein-try &#34;0.4.3&#34;]}} I wanted to understand Prismatic’s Schema and wanted to try it."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="http://rubygeek.comcss/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="http://rubygeek.comcss/main.css" />

	
		<script src="http://rubygeek.comjs/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="http://rubygeek.com">Rubygeek</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">18</span>
							<span class="rest">Apr 2015</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Using lein-try to learn Prismatic Schema</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>When I first heard of <code>lein-try</code> on the <a href="http://blog.cognitect.com/cognicast/050-luke-vanderhart-ryan-neufeld">Cognitect Podcast</a> (and then again in the <a href="http://shop.oreilly.com/product/0636920029786.do">Clojure Cookbook</a> I thought wow! How cool is that! I tried it with following the example in the <a href="https://github.com/rkneufeld/lein-try">readme</a> <code>clj-time</code> to get familar with using it.</p>
<p>First add lein-try to your ~/.lein/profiles plugins vector, run <code>lein deps</code> to get it installed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">{<span style="color:#e6db74">:user</span> {<span style="color:#e6db74">:plugins</span> [lein-try <span style="color:#e6db74">&#34;0.4.3&#34;</span>]}}
</code></pre></div><p>I wanted to understand <a href="https://github.com/Prismatic/schema">Prismatic’s Schema</a> and wanted to try it.  I wanted to start simple so I could understand it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">lein try <span style="color:#960050;background-color:#1e0010">“</span>prismatic/schema<span style="color:#960050;background-color:#1e0010">”</span>
</code></pre></div><p>A repl starts, then require the library and give it an alias</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">(<span style="color:#a6e22e">require</span> <span style="color:#f92672">&#39;</span>[schema.core <span style="color:#e6db74">:as</span> s])
</code></pre></div><p>Ok now ready to play!</p>
<p>First we need to define a schema:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#66d9ef">def </span>Recipe <span style="color:#e6db74">&#34;a recipe&#34;</span> {<span style="color:#e6db74">:name</span> s/Str})
<span style="color:#f92672">#</span><span style="color:#e6db74">&#39;user/Recipe</span>
</code></pre></div><p>Then we can use validate on a data structure to make sure it matches</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#a6e22e">s/validate</span> Recipe {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Chicken and Rice&#34;</span>})
{<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Chicken and Rice&#34;</span>}
</code></pre></div><p>On success we get back the same structure. However, if we pass an invalid structure</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#a6e22e">s/validate</span> Recipe {<span style="color:#e6db74">:name</span> <span style="color:#ae81ff">42</span>})
</code></pre></div><p>Wait a minute. What is this? an actually helpful error message in Clojure?!?!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">ExceptionInfo Value does not match schema<span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#e6db74">:name</span> (not (instance? java.lang.String <span style="color:#ae81ff">42</span>))} schema.core/validate (<span style="color:#a6e22e">core.clj</span><span style="color:#e6db74">:161</span>)
</code></pre></div><p>It tells you the keyword of the invalid value and what value was passed in. Nice.</p>
<p>We can validate, but what does check do?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#a6e22e">s/check</span> Recipe {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Chicken and Rice&#34;</span>})
nil
user=&gt; (<span style="color:#a6e22e">s/check</span> Recipe {<span style="color:#e6db74">:name</span> <span style="color:#ae81ff">42</span>})
{<span style="color:#e6db74">:name</span> (not (instance? java.lang.String <span style="color:#ae81ff">42</span>))}
</code></pre></div><p>Looks like you’d use check when you are prepared to deal with nil, and validate when a representation of the data structure is needed.</p>
<p>Now lets try a more complex example.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#66d9ef">def </span>Source {<span style="color:#e6db74">:name</span> s/Str <span style="color:#e6db74">:url</span> s/Str <span style="color:#e6db74">:year</span> s/Int})
<span style="color:#f92672">#</span><span style="color:#e6db74">&#39;user/Source</span>
user=&gt; (<span style="color:#a6e22e">s/validate</span> Source {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Food Network&#34;</span> <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;http://www.foodnetwork.com&#34;</span> <span style="color:#e6db74">:year</span> <span style="color:#ae81ff">2015</span>})
{<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Food Network&#34;</span>, <span style="color:#e6db74">:year</span> <span style="color:#ae81ff">2015</span>, <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;http://www.foodnetwork.com&#34;</span>}
</code></pre></div><p>This example is Source which consists of 3 elements. Lets try leaving one off:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#a6e22e">s/validate</span> Source {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Food Network&#34;</span> <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;http://www.foodnetwork.com&#34;</span> })

ExceptionInfo Value does not match schema<span style="color:#960050;background-color:#1e0010">:</span> {<span style="color:#e6db74">:year</span> missing-required-key} schema.core/validate (<span style="color:#a6e22e">core.clj</span><span style="color:#e6db74">:161</span>)
</code></pre></div><p>This makes me think maybe there is a way to indicate an optional value? Reading down farther on the <a href="https://github.com/Prismatic/schema">documentation</a> I see how to make keys optional. Lets redefine our Source with year as optional:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#66d9ef">def </span>Source {<span style="color:#e6db74">:name</span> s/Str <span style="color:#e6db74">:url</span> s/Str (<span style="color:#a6e22e">s/optional-key</span> <span style="color:#e6db74">:year</span>) s/Int})
<span style="color:#f92672">#</span><span style="color:#e6db74">&#39;user/Source</span>

user=&gt; (<span style="color:#a6e22e">s/validate</span> Source {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Food Network&#34;</span> <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;http://www.foodnetwork.com&#34;</span> })
{<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Food Network&#34;</span>, <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;http://www.foodnetwork.com&#34;</span>}
</code></pre></div><p>Sweet! I also read that since Schemas are just data structures they are composable. Lets add Source to Recipe to make a more complex structure.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clj" data-lang="clj">user=&gt; (<span style="color:#66d9ef">def </span>Recipe <span style="color:#e6db74">&#34;a recipe with source&#34;</span> {<span style="color:#e6db74">:name</span> s/Str <span style="color:#e6db74">:source</span> Source})
<span style="color:#f92672">#</span><span style="color:#e6db74">&#39;user/Recipe</span>
user=&gt; Recipe
{<span style="color:#e6db74">:name</span> java.lang.String, <span style="color:#e6db74">:source</span> {<span style="color:#e6db74">:name</span> java.lang.String, <span style="color:#e6db74">:url</span> java.lang.String, <span style="color:#f92672">#</span>schema.core.OptionalKey{<span style="color:#e6db74">:k</span> <span style="color:#e6db74">:year</span>} Int}}

user=&gt; (<span style="color:#a6e22e">s/validate</span> Recipe {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Chicken and Rice&#34;</span> <span style="color:#e6db74">:source</span> {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;FoodNetwork&#34;</span> <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;www.foodnetwork.com&#34;</span>}})
{<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;Chicken and Rice&#34;</span>, <span style="color:#e6db74">:source</span> {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;FoodNetwork&#34;</span>, <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;www.foodnetwork.com&#34;</span>}}
</code></pre></div><p>Nice!! Since I’m a ruby developer by day, I think how could I do this in ruby? Well, in Rails, we have validations on models and once you set the attributes you <em>could</em> call model.valid? which would return boolean. If it’s not valid, it populates a errors attribute on the model with a nested hash of key/error messages. Composing two together is not as straightforward. You might be able to with the <code>accepts_nested_attributes_for</code> on a Recipe model, but I conclude its not going to be as elegant as using Clojure and Schema :)</p>
<p>Using <code>lein-try</code> made it easy to experiement with a library and poke around to practice :)</p>

			</div>

			<div class="tags">
				
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


</body>
</html>
