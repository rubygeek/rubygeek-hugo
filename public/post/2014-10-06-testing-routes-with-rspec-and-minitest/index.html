<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Testing routes with RSpec and Minitest - Rubygeek</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Testing routes with RSpec and Minitest" />
<meta property="og:description" content="The poor often forgotten routes folder in your tests or specs folder (if you even have one!). People don&#39;t know what goes in them or how to write them. I like to write them because they are pretty easy to write and often a great first-step when it comes to a legacy codebase.
It gives you the chance to get a good look at that routes file and see if there are routes there you really don&#39;t need?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://rubygeek.com/post/2014-10-06-testing-routes-with-rspec-and-minitest/" />
<meta property="article:published_time" content="2014-10-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2014-10-06T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Testing routes with RSpec and Minitest"/>
<meta name="twitter:description" content="The poor often forgotten routes folder in your tests or specs folder (if you even have one!). People don&#39;t know what goes in them or how to write them. I like to write them because they are pretty easy to write and often a great first-step when it comes to a legacy codebase.
It gives you the chance to get a good look at that routes file and see if there are routes there you really don&#39;t need?"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="http://rubygeek.comcss/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="http://rubygeek.comcss/main.css" />

	
		<script src="http://rubygeek.comjs/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="http://rubygeek.com">Rubygeek</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">06</span>
							<span class="rest">Oct 2014</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Testing routes with RSpec and Minitest</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>The poor often forgotten routes folder in your tests or specs folder (if you even have one!). People don't know what goes in them or how to write them. I like to write them because they are pretty easy to write and often a great first-step when it comes to a legacy codebase.</p>
<p>It gives you the chance to get a good look at that routes file and see if there are routes there you really don't need? Often the <code>resources :whatever</code> is the culprit, the others are either out of date (the controller/action was removed but routes file never updated) .. I wondered why should you only include the routes you need? what harm is there? It make the <code>rake routes</code> file cleaner but are there other reasons to be very specific in <code>routes.rb</code> ?</p>
<p>So I sought the wisdom of  twitter:</p>
<pre><code>Peter Harkins @pushcx
Documentation to future coders.
--
Karthik Hariharan @hkarthik 
avoids the &quot;action controller method not found&quot; errors and pushes 
a 404 instead of a 500. Really important with REST APIs.
--
Brad Fults @h3h
FWIW, I highly recommend avoiding `resources` and preferring 
a `get/post/patch` for every route. Much clearer.  
--
Caleb Thompson @calebthompson 
:only 
</code></pre>
<p>I got some really good answers!!  <a href="https://twitter.com/rubygeek/status/516612558238015488">See all the responses</a></p>
<p>Avoiding the resources magic is one way to make it very clear:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">get <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/users</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">users</span><span style="color:#e6db74">#</span><span style="color:#e6db74">index</span><span style="color:#e6db74">&#34;</span>
get <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/users/:id</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">users</span><span style="color:#e6db74">#</span><span style="color:#e6db74">show</span><span style="color:#e6db74">&#34;</span> 
post <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/users</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">users</span><span style="color:#e6db74">#</span><span style="color:#e6db74">create</span><span style="color:#e6db74">&#34;</span>
</code></pre></div><p>Verses resources style:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">resources <span style="color:#e6db74">:users</span>, <span style="color:#e6db74">only</span>: <span style="color:#f92672">[</span><span style="color:#e6db74">:index</span>, <span style="color:#e6db74">:show</span>, <span style="color:#e6db74">:create</span><span style="color:#f92672">]</span>
</code></pre></div><p>Using <code>only</code> is also pretty clear and maybe less messy? This probably come down to personal preference and which way allows you to sleep best at night. Decide with your team so you can be consistant in your <code>routes.rb</code> file.</p>
<p>So how do you test them?</p>
<p>It depends on what test framework you are using. Here's what I've figured it out.</p>
<h3 id="rspec">RSpec</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">  context <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">should route to member_sessions</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
    it <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">should initialize a new session</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
      expect(<span style="color:#e6db74">get</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/member_sessions/new</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>to route_to(<span style="color:#e6db74">controller</span>: <span style="color:#e6db74">&#39;member_sessions&#39;</span>, <span style="color:#e6db74">action</span>: <span style="color:#e6db74">&#39;new&#39;</span>)
    <span style="color:#66d9ef">end</span>
    it <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">should create a new session</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
      expect(<span style="color:#e6db74">post</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/member_sessions</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>to route_to(<span style="color:#e6db74">controller</span>: <span style="color:#e6db74">&#39;member_sessions&#39;</span>, <span style="color:#e6db74">action</span>: <span style="color:#e6db74">&#39;create&#39;</span>)
    <span style="color:#66d9ef">end</span>
    it <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">should destroy a session</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
      expect(<span style="color:#e6db74">delete</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/member_sessions/1</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>to route_to(<span style="color:#e6db74">controller</span>: <span style="color:#e6db74">&#39;member_sessions&#39;</span>, <span style="color:#e6db74">action</span>: <span style="color:#e6db74">&#39;destroy&#39;</span>, id: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#34;</span>)
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
</code></pre></div><p>This will test that the method, url and params will go to the right controller/action. It seems pretty straight forward right?</p>
<h3 id="minitest--testunit">Minitest / TestUnit</h3>
<p>We have three methods:</p>
<ul>
<li><code>assert_generates</code> - testing that the provided url, will break down to a controller,action and parameters</li>
<li><code>assert_recognizes</code>   - testing that rails will recognize the route, given controller and action, it goes to a certain method and path</li>
<li><code>assert_routing</code> - a combination of the above, almost literally, if you look at the source!</li>
</ul>
<p>One thing I can't figure out is how to test the methods along with the routing info like I can with RSpec.  We can test in other ways (feature tests), but its not quite as nice as RSpec. I guess that is just a difference in the two frameworks. I  found when the same path is common to multiple methods, than <code>assert_generates</code> works and <code>assert_routing</code> does not (and <code>assert_recognizes</code> does not also). For example in the case of Create, Update, Delete and Show they use the same path so I have to use the <code>assert_generates</code> to that the path goes to the right controller.</p>
<pre><code>| method | path          | controller |
| ------ | ------------- | ---------- |
| create | /register/:id |  register  |
| update | /register/:id |  register  |
| delete | /register/:id |  register  |
| show   | /register/:id |  register  |
</code></pre><p>So once I realized that, I understood (duh) which route testing methods to use. Some might argue these are pointless, but I still think its valuable as it forces you to really think about your routes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RoutingTest</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ActionDispatch</span><span style="color:#f92672">::</span><span style="color:#66d9ef">IntegrationTest</span>
    it <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">routes to register index</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
      assert_generates <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/register</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">controller</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">register</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">action</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">index</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">end</span>
    it <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">routes to register show</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
      assert_generates <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/register/1</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">controller</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">register</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">action</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">show</span><span style="color:#e6db74">&#34;</span>, id: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">end</span>
</code></pre></div><p>These are mostly the same, except for the starting of the test. The testunit style has a class and spec style has a description. The describe string ** must ** end in Acceptance Test.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">describe <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Routing Acceptance Test</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
  it <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">routes to register index</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
    assert_generates <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/register</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">controller</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">register</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">action</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">index</span><span style="color:#e6db74">&#34;</span>
  <span style="color:#66d9ef">end</span>

  it <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">routes to register show</span><span style="color:#e6db74">&#34;</span> <span style="color:#66d9ef">do</span>
    assert_generates <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/register/1</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">controller</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">register</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">action</span>: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">show</span><span style="color:#e6db74">&#34;</span>, id: <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#34;</span>
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>As I've been writing route tests, I've increase the security, clarity and interface to my apps. My routes file has become a very clear documentation of the api of my application. I hope that testing routes becomes as important to you as it is for me!</p>

			</div>

			<div class="tags">
				
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


</body>
</html>
